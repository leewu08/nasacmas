{% extends "layout.html" %}

{% block body %}
<h2 class="my-4 text-center">ğŸ“¦ Predictive Maintenance Dashboard</h2>
<div class="grid-stack">
  {% set layout = [
    {'id': 'performance', 'w': 6, 'h': 3, 'x': 0, 'y': 0, 'tpl': 'partials/widget_performance.html'},
    {'id': 'schedule', 'w': 6, 'h': 3, 'x': 6, 'y': 0, 'tpl': 'partials/widget_schedule.html'},
    {'id': 'compare', 'w': 6, 'h': 3, 'x': 0, 'y': 3, 'tpl': 'partials/widget_compare.html'},
    {'id': 'sensors', 'w': 6, 'h': 3, 'x': 6, 'y': 3, 'tpl': 'partials/widget_sensors.html'},
    {'id': 'explain', 'w': 6, 'h': 3, 'x': 0, 'y': 6, 'tpl': 'partials/widget_explain.html'}
  ] %}

  {% for widget in layout %}
  <div class="grid-stack-item"
       gs-id="{{ widget.id }}"
       gs-w="{{ widget.w }}"
       gs-h="{{ widget.h }}"
       gs-x="{{ widget.x }}"
       gs-y="{{ widget.y }}">
    <div class="grid-stack-item-content">
      {% include widget.tpl %}
    </div>
  </div>
  {% endfor %}
</div>
{% endblock %}

{% block scripts %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gridstack@9.2.1/dist/gridstack.min.css" />
<script src="https://cdn.jsdelivr.net/npm/gridstack@9.2.1/dist/gridstack-all.min.js"></script>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // âœ… ì „ì—­ì— í• ë‹¹í•´ì„œ ë””ë²„ê¹… ê°€ëŠ¥í•˜ê²Œ í•¨
    window.grid = GridStack.init({
      float: true,
      cellHeight: 80,
      disableOneColumnMode: false,
      resizable: { handles: 'e, se, s, sw, w' },
      draggable: true
    });

    const savedLayout = localStorage.getItem('user_layout');
    if (savedLayout) {
      try {
        grid.removeAll();
        grid.load(JSON.parse(savedLayout));
        console.log('âœ… ì‚¬ìš©ì layout ì ìš© ì™„ë£Œ');
      } catch (e) {
        console.warn('âŒ layout ì ìš© ì‹¤íŒ¨:', e);
      }
    }

    grid.on('change', function (e, items) {
      const layout = grid.save();
      localStorage.setItem('user_layout', JSON.stringify(layout));
      console.log("ğŸ’¾ layout ì €ì¥ë¨:", layout);
    });

    // âœ… ë””ë²„ê¹…ìš© ì¶œë ¥
    console.log("ğŸ“¦ GridStack initialized:", window.grid);
  });
</script>
{% endblock %}